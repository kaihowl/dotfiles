#!/usr/bin/expect
set timeout 10

spawn zsh "-i";
expect "➜";

# Clear up input with ctrl-w.
send "\x17";
# Flush buffer.
expect "*"

send "cdtmp\r"
expect "➜";

# Make the test hermetic.
send "export _ZO_DATA_DIR=\$(pwd)\r"
expect "➜";

# Set up test folders.
send "mkdir veryuniquestring; cd veryuniquestring; cd ..; mkdir other; cd other\r"
expect "➜";

# Start fzf completion, expect a single match that immediately shows up,
# and it selected automatically.
send "j veryuniquestring**\x09"
expect {
  "cd " {}
  timeout { exit 1 }
}

# Execute "cd" command that was ZLE' edited on screen.
send "\r";
expect "➜";

# Check correct directory.
# "end.*end" matches the input "echo ... end" and the output of it
send "echo current dir is: \$(pwd) end\r"
expect {
  -re "current dir is: .*veryuniquestring end" {}
  -re "end.*end" { exit 1 }
}
