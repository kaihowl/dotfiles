name: 'Install git-perf'
description: 'Install git-perf binary'
outputs:
  git-perf-path:
    description: 'Path containing the git-perf binary'
    value: ${{ steps.install.outputs.path }}
runs:
  using: "composite"
  steps:
    - id: install
      run: |
        mkdir -p ~/.git-perf/
        pushd ~/.git-perf
        os=$(uname -s)
        # TODO(kaihowl) install latest
        if [ $os = "Linux" ]; then
          gitperf_url="https://github.com/kaihowl/git-perf/releases/download/0.14.0/gitperf-0.14.0-x86_64-unknown-linux-musl.tar.gz"
        elif [ $os = "Darwin" ]; then
          gitperf_url="https://github.com/kaihowl/git-perf/releases/download/0.14.0/gitperf-0.14.0-x86_64-apple-darwin.tar.gz"
        else
          echo "Unsupported OS"
          exit 1
        fi
        curl -L "$gitperf_url" | tar -xz --strip-components=1
        echo 'git-perf-path=$HOME/.git-perf' >> $GITHUB_OUTPUT
      shell: bash
