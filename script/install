#!/bin/bash -e
#
# Run all dotfiles installers.
export DOTS=$HOME/.dotfiles

cd "$(dirname $0)"/..

if [[ "$(uname)" == "Linux" && "$(lsb_release -i)" == *"Ubuntu"* ]]; then
  sudo apt-get update
fi

if [ "$(uname -s)" == "Darwin" ]; then
  # We only want our explicit cleanup when multiple installers run
  export HOMEBREW_NO_INSTALL_CLEANUP

  source $DOTS/common/brew.sh

  ensure_brew_installed

  brew cleanup
  brew update
fi

# find the installers and run them iteratively
installers=$(find . -name install.sh)
for installer in ${installers}; do
  echo -e "Running \e[32m${installer}\e[0m"
  sh -c "${installer}"
done
